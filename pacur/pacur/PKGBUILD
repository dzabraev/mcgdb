targets=(
#    "archlinux"
#    "centos"
#    "debian"
    "fedora"
#    "ubuntu"
)
pkgname="mcgdb"
pkgver="1.2"
pkgrel="1"
pkgdesc="midnight commander as gdb front end"
pkgdesclong=(
    "mcgdb adds to gdb two additional windows:"
    "1. current execution position in source code"
    "2. window with local vars, registers, threads and stack"
)
maintainer="Maxim Dzabraev <dzabraew@gmail.com>"

arch="amd64"
license=("GPLv3")
section="utils"
priority="optional"
url="https://github.com/dzabraev/${pkgname}"

sources=(
    "https://github.com/dzabraev/mcgdb/archive/master.tar.gz"
)

hashsums=(
    "fce2709c3aac9d53fff6fdae97be39ce"
)


depends:ubuntu=(
  "libglib2.0-dev"
  "libslang2-dev"
  "libpython2.7-dev"
  "python"
)

makedepends:ubuntu=(
  "libglib2.0-dev"
  "libslang2-dev"
  "libpython2.7-dev"
  "python"
  "texinfo"
  "g++"
  "pkg-config"
)


depends:ubuntu-precise=(
  "libglib2.0-dev"
  "libslang2-dev"
  "python2.7-dev"
  "python"
)

makedepends:ubuntu-precise=(
  "libglib2.0-dev"
  "libslang2-dev"
  "python2.7-dev"
  "python"
  "texinfo"
  "g++"
  "pkg-config"
)













depends:fedora=(
  "glib2-devel"
  "slang-devel"
  "python-devel"
  "python"
)


makedepends:fedora=(
  "glib2-devel"
  "slang-devel"
  "python-devel"
  "python"
  "texinfo"
  "gcc-c++"
  "rpm-build"
)



build() {
    cd ${srcdir}
    mkdir -p root

    wget "https://ftp.gnu.org/gnu/gdb/gdb-7.12.1.tar.xz"
    tar xvJf "gdb-7.12.1.tar.xz"
    cd "gdb-7.12.1"
    mkdir obj
    cd obj
    ../configure --with-python=python2 --program-prefix=mcgdb_ --prefix=/usr/bin/mcgdb_aux
    make -j4
    cd ${srcdir}

    wget "http://www.digip.org/jansson/releases/jansson-2.10.tar.gz"
    tar xzvf "jansson-2.10.tar.gz"
    cd "jansson-2.10"
    mkdir -p obj
    cd obj
    ../configure --disable-shared --prefix=${srcdir}/root
    make -j4
    make install
    cd ${srcdir}


    tar xzvf "master.tar.gz"
    cd mcgdb-master
    mkdir obj
    cd obj
    PKG_CONFIG_PATH=${srcdir}/root/lib/pkgconfig ../configure --prefix=/usr GDB=/usr/bin/mcgdb_aux/bin/mcgdb_gdb
    make -j4
    cd ${srcdir}
}

package() {
    cd ${srcdir}/gdb-7.12.1/obj
    make install DESTDIR=${pkgdir}
    cd ${srcdir}/mcgdb-master/obj
    make install DESTDIR=${pkgdir}
}